import time
import random

import numpy as np
import pandas as pd
from tqdm import tqdm
import matplotlib.pyplot as plt

from relcadilac.data_generator import GraphGenerator
import relcadilac.utils as utils

def test_my_bic(num_runs):
    my_time, ananke_time = [], []
    for i in tqdm(range(100)):
        num_nodes = random.randint(5, 15)
        avg_degree = random.randint(2, num_nodes-1)
        frac_directed = random.uniform(0.2, 0.7)
        degree_variance = 0.1
        admg_model = random.choice(['bow-free', 'ancestral'])
        num_samples = random.choice([1_000, 2_000, 4_000, 8_000])
        D, B, X, S, bic, pag = generator.get_admg(num_nodes, avg_degree, frac_directed, degree_variance=degree_variance, plot=False, num_samples=num_samples, do_sampling=True, get_pag=False)
        start = time.perf_counter()
        bic = utils.get_bic(D, B, X, S)
        my_time.append(time.perf_counter() - start)
        start = time.perf_counter()
        my_bic = utils.get_ananke_bic(D, B, X)
        ananke_time.append(time.perf_counter() - start)
    # plt.plot(my_time, label='me')
    # plt.plot(ananke_time, label='ananke')
    # plt.show()
    print(ananke_time)
    print(my_time)
    print(sum(ananke_time))
    print(sum(my_time))
    print((sum(ananke_time) - sum(my_time)) / sum(ananke_time))

def plot_something():
    ananke_time = [0.27670078599476255, 0.11437626300175907, 0.168410808997578, 0.11834327299584402, 0.24182798899710178, 0.21744126999692526, 0.10233453200635267, 0.10506848800287116, 0.34334318000037456, 0.06181572000059532, 0.06066337700030999, 0.2514304650030681, 0.6744934359958279, 0.12637700799677987, 0.1368746260050102, 0.23866378799721133, 0.10103876100038178, 0.07195680100267055, 0.08892807100346545, 0.14096728100412292, 0.12670023200189462, 0.11930330600443995, 0.0663606290036114, 0.11828700800106162, 0.07664998800464673, 0.1653802589935367, 0.0744726909979363, 0.050555819005239755, 0.015999673996702768, 0.18233338500431273, 0.11842405399511335, 0.6, 0.10948765200009802, 0.10149225799978012, 0.07911498100293102, 0.08331188099691644, 0.10961938800028292, 0.038049007998779416, 0.12400972699833801, 0.12135072999808472, 0.08492436199594522, 0.09570527899631998, 0.07464549299766077, 0.38154152799688745, 0.6596167790048639, 0.08390128199971514, 0.0736071150022326, 0.05898577399784699, 0.24880938899877947, 0.08653790700191166, 0.6, 0.07883817300898954, 0.15886195799976122, 0.07022473099641502, 0.027026408992242068, 0.14030725799966604, 0.8846448910044273, 0.09317860701412428, 0.07249751601193566, 0.03100979000737425, 0.10872599299182184, 0.06446059599693399, 0.10336202799226157, 0.09448736999183893, 0.1241525319928769, 0.05319713101198431, 0.13541594900016207, 0.33979340000951197, 0.0987665319989901, 0.09724449599161744, 0.1571186020009918, 0.09091403400816489, 0.25892382599704433, 0.3696239140117541, 0.5007677070097998, 0.08277042901318055, 0.07743028800177854, 0.07901797699742019, 0.1774449079966871, 0.12481846299488097, 0.09879476300557144, 0.09751737899205182, 0.07700281401048414, 0.08295559500402305, 0.22792186299921013, 0.0982433699973626, 0.7370568540063687, 0.043833290998009034, 0.12162467499729246, 0.0763029890076723, 0.1078627660026541, 0.27433881600154564, 0.09383711799455341, 0.08844752398726996, 0.04376661799324211, 0.05478531098924577, 0.12238546999287792, 0.0736661120026838, 0.10008821300289128, 0.3066903500002809]
    my_time = [0.20133495600020979, 0.02330283499759389, 0.038638008998532314, 0.0239173829977517, 0.10018874399975175, 0.06732421900233021, 0.019171239000570495, 0.039408397999068256, 0.2744388200007961, 0.010193789996264968, 0.0057189319995814, 0.12522042799537303, 0.2808424909962923, 0.029319052999198902, 0.047636114999477286, 0.07807200399838621, 0.03600767500029178, 0.011003802996128798, 0.023903737994260155, 0.07771006700204452, 0.06783857999835163, 0.03903555199940456, 0.021569497999735177, 0.05102389300009236, 0.02411114500137046, 0.0540668169996934, 0.020402677997481078, 0.008062478998908773, 0.0019427879960858263, 0.09564561799925286, 0.04197926900087623, 0.3434877200052142, 0.03706848700676346, 0.031327675002103206, 0.013610752001113724, 0.02185456999723101, 0.020312380001996644, 0.012706563997198828, 0.045004038998740725, 0.04496973499772139, 0.02856453300046269, 0.02269803600211162, 0.022089318998041563, 0.1730979939966346, 0.6528260159975616, 0.01855866400001105, 0.018370361998677254, 0.008298699998704251, 0.15109216199925868, 0.018264484002429526, 0.8934090990005643, 0.012356916005956009, 0.06322691099194344, 0.021947613000520505, 0.0054296769958455116, 0.028804140994907357, 0.5335146249999525, 0.036542488989653066, 0.01295327499974519, 0.0062529070128221065, 0.014860988987493329, 0.011839626007713377, 0.016766198008554056, 0.03601270500803366, 0.026279672005330212, 0.014640839988715015, 0.02244145299482625, 0.27725653600646183, 0.02677161699102726, 0.018607049001730047, 0.06242452599690296, 0.017305231012869626, 0.2973512250027852, 0.3080694329983089, 0.40345872000034433, 0.014518073003273457, 0.012686229994869791, 0.01638461100810673, 0.09174803999485448, 0.04106426400539931, 0.046127541005262174, 0.03052891000697855, 0.015933724003843963, 0.016080286004580557, 0.12840692199824844, 0.035252706991741434, 0.2852591359987855, 0.008058452003751881, 0.051495307008735836, 0.016001841009710915, 0.033946391005883925, 0.24006414199538995, 0.0285381529974984, 0.0323019259958528, 0.006123908009612933, 0.015977226008544676, 0.036600253006326966, 0.012251894004293717, 0.028159359993878752, 0.16515036899363622]
    # plt.plot(my_time, label='me')
    # plt.plot(ananke_time, label='ananke')
    # plt.legend()
    # plt.show()
    # print(ananke_time)
    # print(my_time)
    print(sum(ananke_time))
    print(sum(my_time))
    print((sum(ananke_time) - sum(my_time)) / sum(ananke_time))

if __name__ == '__main__':
    generator = GraphGenerator()
    num_runs = 10
    plot_something()
